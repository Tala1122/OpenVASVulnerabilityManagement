# OpenVAS Vulnerability Management

Steps:
1. Create Azure Account
2. Prepare Vulnerability Management Scanner
3. Create Client Virtual Machine and Make it Vulnerable
4. Configure OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM
5. Make Configurations for Credentialed Scans (Within VM)
6. Make Configurations for Credentialed Scans (OpenVAS)
7. Execute Credentialed Scan against our Vulnerable Windows VM
8. Remediate Vulnerabilities
9. Verify Remediations

**Create Azure Account**\
You can create a Free Microsoft Azure Account where you get $200 for 30 days.

**Prepare Vulnerability Management Scanner**\
After you are logged in to Azure, go to the Marketplace and search for “OpenVAS secured and supported by HOSSTED”. 
Start with a pre-set configuration (pick the weakest one available), then continue to Create VM. You have to create a new resource group, you can call it: "Vulnerability-Management". Then you can name the VM: "OpenVAS". After that, you also need to create a user and password. Then in the Monitoring tab, click Disable Boot Diagnostic. And finally, create the VM. 
After the VM is created, you can SSH into it using the credentials you just made: ssh user@ipaddressofVM
After it is finished loading, tt should show the web app URL and default username and password at this point, attempt to go to the URL in the browser and login with the username and password. If it fails you can try to login with admin/admin. 
After logging in, you should reset the password from the default to the one that you configured. 

**Create Client Virtual Machine and Make it Vulnerable**\
Go back to your Azure account and create a new VM. Assign it to the same resource group as before and you can name it: "Win10-Vulnerable". Make the region the same as it was before for the first VM, make sure the virtual network is also the same as OpenVAS. The image is "Windows 10 Pro" and it can be any size with 2 vCPUs. Pick a username and password for authentication and create the VM. 
After the VM has been created, ensure you can RDP into it with the credentials you created.
After logging in, make the VM vulnerable:
- Disable the Windows Firewall
- [Old Software](https://drive.google.com/drive/u/2/folders/1n83ilCjZWZulbDdYnUe9wQPK2buY47_U)
  - Install an Old Version of FireFox: Firefox Setup 97.0b5
  - Install an Old Version of VLC Player: vlc-1.1.7-win32
  - Install an Old Version of Adobe Reader: 10.0_AdbeRdr1000_en_US_1_
- Restart the VM

**Configure OpenVAS to Perform First Unauthenticated Scan against our Vulnerable VM**\
Go back to OpenVAS on the Web and click on Assets → Hosts → New Host.
Add the Client VM PRIVATE IP Address. Create a New Target from the Host, name it “Azure Vulnerable VMs”. 
Then create a new task:
- Name & Comment: “Scan - Azure Vulnerable VMs”
- Scan Targets → “Azure Vulnerable VMs”
And finally Start the "Scan - Azure Vulnerable VMs" Task.
Once the scan is finished, click the date under “Last Report” to see the results. We get a severity of Medium. 
The main thing we notice is that the old vulnerable software does not show up in the list of vulnerabilites, that is because we ran an unauthenticated scan.

**Make Configurations for Credentialed Scans (Within VM)**\
Go back to VM:
- Disable User Account Control
- Enable Remote Registry (open services.msc - find remote registry in the list and change it from disabled to automatic)
- Set Registry Key 
  - Launch Registry Editor (regedit.exe) in “Run as administrator” mode and grant Admin Approval, if requested.
  - Navigate to HKEY_LOCAL_MACHINE 
  - Open SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System 
  - Create a new DWORD (32-bit) value with the following properties:  Name: LocalAccountTokenFilterPolicy  Value: 1
- Restart the VM

**Make Configurations for Credentialed Scans (OpenVAS)**\
Go back to OpenVAS web:
- Go to Configuration → Credentials → New Credential
  - Name / Comment → “Azure VM Credentials”
  - Allow Insecure Use: Yes
  - Add username and password for VM
- Go to Configuration → Targets → CLONE the Target we made before
  - NEW Name / Comment: “Azure Vulnerable VMs - Credentialed Scan”
  - Ensure the Private IP is still accurate
  - Credentials → SMB → Select the Credentials we just made: Azure VM Credentials

**Execute Credentialed Scan against our Vulnerable Windows VM**
- Go to Scans → Tasks.
- Clone the “Scan - Azure Vulnerable VMs” Task, then Edit it:
  - Name / Comment → “Scan - Azure Vulnerable VMs - Credentialed”
  - Targets: Azure Vulnerable VMs - Credentialed Scan
Launch the new Credentialed Scan, wait for it to finish.
After the credentialed scan finishes, you can immediately see the difference in findings. We get a severity of High and we can clearly see all of the vulnerabilities that got detected with Firefox, Adobe and all of the old software. 

**Remediate Vulnerabilities**
- Log back into your Win10-Vulnerable VM
- Uninstall Adobe Reader, VLC Player, and Firefox
- Restart the VM

**Verify Remediation**\
Re-initiate the “Scan - Azure Vulnerable VMs - Credentialed” scan and observe the results.





